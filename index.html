<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RateHound</title>
<meta name="theme-color" content="#134c07">
<style>
  :root{--brand:#134c07;--ink:#134c07;--muted:#6b7280;--border:#134c07}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Arial}

  /* full-viewport helpers (iOS-safe) */
  .vh{height:100vh}
  @supports (height:100dvh){ .vh{height:100dvh} }
  @supports (height:100svh){ .vh{height:100svh} }

  /* SPLASH */
  #splash{
    background:var(--brand); color:#fff;
    display:flex; align-items:center; justify-content:center; text-align:center;
  }
  #splash .inner{width:90%;max-width:420px;display:flex;flex-direction:column;gap:24px;align-items:center}
  .logo{width:180px;height:auto;display:block}

  /* cross-fade */
  .fade{opacity:1;transition:opacity .45s ease}
  .fade.out{opacity:0;pointer-events:none}

/* SIGNUP */
#signup {
  background:#fff; 
  color:var(--ink); 
  display:none;
}
#signup.show { display:flex }
#signup .inner {
  margin:0 auto; 
  width:min(92%,420px); 
  padding:28px 16px; 
  display:flex; 
  flex-direction:column; 
  gap:14px;
}
#signup .inner h1 {
  margin:0 0 12px;
  font-size:26px;
  font-weight:700;
  text-align:center;
  color:var(--ink);
}
.field {
  width:100%;
  padding:12px 14px;
  border:2px solid var(--border);
  border-radius:12px;
  background:#fff;
  color:var(--ink);
  font-size:16px;
  box-sizing:border-box;
}

/* Disabled state for Sign Up button */
#signUpBtn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Sign Up button styles */
#signUpBtn {
  background:var(--brand);
  color:#fff;
  font-size:20px;
  padding:16px 20px;
  border:none;
  border-radius:999px;
  font-weight:700;
  text-align:center;
  cursor:pointer;
}
#signUpBtn:active {
  background:#0f3a05;
  transform:scale(.98);
}

  .btn:active{transform:scale(.99)}
  .hint{color:var(--muted); font-size:12px; text-align:center; margin-top:6px}
  /* Toasts (demo notifications) */
#toasts{
  position:fixed;
  bottom:28px; left:50%;
  transform:translateX(-50%);
  display:flex; flex-direction:column; align-items:center; gap:8px;
  z-index:1000;
}

.toast{
  background:#134c07; color:#fff;
  border-radius:999px;             /* makes them pill-shaped */
  padding:10px 20px;               /* slimmer vertically, wider horizontally */
  box-shadow:0 3px 10px rgba(0,0,0,.15);
  font-size:14px; font-weight:500;
  text-align:center; white-space:nowrap;   /* keeps it one line */
  max-width:min(92vw, 480px);
  opacity:0; transform:translateY(10px);
  transition:opacity .25s ease, transform .25s ease;
}

.toast.show{ opacity:1; transform:translateY(0) }

.toast a{
  color:#fff;
  text-decoration:underline;
  font-weight:600;
}
.toast a{ color:#fff; text-decoration:underline; }
  
  /* PAGE 3 — Utility choice */
  #utility{background:#fff;color:var(--ink);display:none}
  #utility.show{display:flex}
 #utility .inner{
  margin:0 auto;
  width:min(92%,420px);
  padding:28px 16px;                  /* body provides chip space now */
  display:flex;
  flex-direction:column;
  gap:16px;
  justify-content:flex-start;
  min-height:auto;
}
  #utility h1{margin:0 0 12px; font-size:26px; font-weight:700; text-align:center; color:var(--ink);}
  .btn.tall{
    height:8vh; display:flex; align-items:center; justify-content:center;
    border:2px solid var(--brand); background:#fff; color:var(--brand);
    border-radius:12px; font-weight:600; font-size:18px; width:100%;
  }
  .btn.selectable{background:#fff;color:var(--brand);border:2px solid var(--brand)}
  .btn.selectable.selected{background:var(--brand);color:#fff}

  .utilityHint{color:var(--muted); text-align:center; margin-top:6px}
  #fetchUtilities{
    margin-top:16px;background:var(--brand);color:#fff;border:none;border-radius:999px;font-size:20px;padding:16px 20px;
    opacity:.5;pointer-events:none;
  }
  #fetchUtilities.enabled{opacity:1;pointer-events:auto}

  /* PAGE 4 — Account intake */
  #upload{background:#fff;color:var(--ink);display:none}
  #upload.show{display:flex}
 #upload .inner{
  margin:0 auto; 
  width:min(92%,420px); 
  padding:28px 16px;
  display:flex; 
  flex-direction:column; 
  gap:14px; 
  justify-content:flex-start; 
  min-height:100vh;
  margin-top:5vh;           /* push content down ~5% of viewport height */
}
  #upload h1{margin:0 0 8px; font-size:26px; font-weight:700; text-align:center}

  .method{
    width:100%; height:8vh; min-height:64px; display:flex; align-items:center; justify-content:center;
    border:2px solid var(--brand); background:#fff; color:var(--brand); border-radius:12px; font-weight:600; font-size:18px; margin-top:10px;
  }
  .method.selected{background:var(--brand);color:#fff}

  .panel[hidden]{display:none}
  .preview{display:none; width:100%; max-height:300px; object-fit:contain; border:1px solid var(--border); border-radius:8px}

  #continueUpload{
    background:var(--brand); color:#fff; border:none; border-radius:999px;
    font-size:20px; padding:16px 20px; opacity:.5; pointer-events:none;
  }
  #continueUpload.enabled{opacity:1; pointer-events:auto}

  /* Modal tip */
  .modal{
    position:fixed; inset:0; display:none; place-items:center; background:#0008; z-index:50; opacity:0; transition:opacity .3s ease;
  }
  .modal.show{display:grid;opacity:1}
  .modal .box{
    background:#fff; color:var(--ink); width:min(92%,420px); border-radius:12px; padding:16px 16px 12px; border:2px solid var(--border); position:relative;
  }
  .modal .close{
    position:absolute; top:10px; right:12px; border:0; background:transparent; font-size:22px; line-height:1; cursor:pointer; color:var(--ink);
  }
  .modal h3{margin:0 0 8px; font-size:18px}
  body.modal-open{overflow:hidden}
/* Loader page */
#loader{
  position: fixed;
  inset: 0;                /* top:0; right:0; bottom:0; left:0 */
  z-index: 999;            /* keep loader above all other sections */
  background: var(--brand) !important;   /* your green behind the animation */
  display: none;
  justify-content: center;
  align-items: center;
  width: 100%;
  height: 100svh;          /* full, safe viewport height */
}
#loader.show{ display:flex; }

/* Lottie wrappers + svg must be transparent */
#lottieContainer,
#lottieContainer > div,
#lottieContainer canvas,
#lottieContainer svg {
  background: transparent !important;
  width: 100% !important;
  height: 100% !important;
  display: block;
}

/* PAGE 5 – Offer */
#offer {
  background:#f6f7f8;
  color:var(--ink);
  display:none
}
  #offer.show{display:flex}
  #offer .inner{margin:0 auto;width:min(92%,420px);padding:28px 16px;display:flex;flex-direction:column;gap:16px;min-height:100vh}
  .card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:20px;box-shadow:0 1px 2px rgba(0,0,0,.03)}
  .card h2{margin:0 0 8px;font-size:22px}
  .compareBox{background:#fff8cc;border-left:4px solid #f2c200;border-radius:10px;padding:10px 12px;font-weight:600}
  .yellowBox {
  background:#fff8cc;
  border-left:4px solid #f2c200;
  border-radius:10px;
  padding:12px;
  text-align:center;
  font-weight:600;
  color:#134c07;
}
  .kv{display:flex;justify-content:space-between;align-items:center;margin:14px 0}
  .kv .big{font-size:28px;font-weight:800}
  .kv small{display:block;font-weight:600;color:var(--muted)}
  .row2{display:flex;gap:20px;margin-top:8px}
  .row2 .blk{flex:1}
  .supplier{display:flex;align-items:center;gap:12px;margin-top:14px;padding-top:12px;border-top:1px solid #e6e8eb}
  .links a{color:#2d7cf6;text-decoration:none}
  .btn--outline{background:#fff;color:var(--brand);border:2px solid var(--brand);border-radius:999px;padding:12px 16px;font-weight:700}
 .chip{
  position:fixed;
  top:10px; right:10px;
  background:#134c07; color:#fff;
  border-radius:999px;
  padding:6px 10px;               /* smaller padding */
  font-size:12px;                 /* smaller text */
  font-weight:600;
  box-shadow:0 2px 6px rgba(0,0,0,.12);
  z-index:1001;
  opacity:.9;
  transform:scale(0.9);           /* subtle shrink */
}
.chip.show{
  opacity:1;
  transform:translateY(0);
}

  /* yellow pills */
.pill{
  background:#fff8cc;
  border-left:4px solid #f2c200;
  border-radius:12px;
  padding:10px 14px;
  text-align:center;
  color:#134c07;
  font-weight:700;
}
.pill.big{ padding:18px 16px; border-radius:14px; }
.pill .num{ display:block; font-size:32px; font-weight:800; line-height:1.1; }
/* unified yellow box styling (for both small + large) */
.yellowBox--sm,
.yellowBox--lg {
  background: #fff8cc;
  border-left: 4px solid #f2c200;
  border-radius: 10px;
  padding: 12px;
  text-align: center;
  color: #134c07;
  font-weight: 700;
  display: block;
  width: max-content;
  margin: 0 auto; /* centers in card */
}

/* slightly smaller font for the smaller pill */
.yellowBox--sm {
  font-size: 16px;
  padding: 10px 12px;
}

/* font adjustments for big numbers in .yellowBox--lg */
.yellowBox--lg .big {
  font-size: 18px;
  font-weight: 700;
  line-height: 1.2;
}
/* green lead line */
.leadGreen{
  color:#134c07;
  font-weight:800;
  font-size:22px;      /* same size you liked on “Estimated Savings” */
  line-height:1.25;
  text-align:center;
}

/* large centered CTA */
.btn-cta{
  background:#134c07; color:#fff; border:0;
  border-radius:999px; font-weight:800; font-size:20px;    
  padding:16px 18px; width:100%; margin-top:12px;
  text-align:center; cursor:pointer;
}
.btn-cta:active{ transform:scale(.99); }



/* add spacing between main sections (except plan + footer details) */
.card > *:not(.row2):not(.supplier):not(.links):not(.disclaimer) {
  margin-bottom: 18px;
}


/* green headline under the divider */
.leadGreen{
  color:#134c07;
  font-weight:800;
  font-size:24px;
  line-height:1.25;
  text-align:center;
}

/* CTA */
.btn-cta{
  background:#134c07;
  color:#fff;
  border:none;
  border-radius:999px;
  font-weight:800;
  padding:14px 18px;
  width:100%;
  margin-top:12px;
  cursor:pointer;
}
.btn-cta:active{ transform:scale(.99) }
}
  /* RESULTS */
#results{background:#f6f7f8;color:var(--ink);display:none}
#results .inner{
  margin:5vh auto 0;              /* pushes content down like intake pages */
  width:min(92%,420px);
  padding:28px 16px;
  display:flex;flex-direction:column;gap:16px;
}

/* small helpers for the redesigned card */
.card .pricePill{
  background:#eef0f2; border-radius:12px;
  padding:18px 22px; display:inline-flex; flex-direction:column; align-items:center;
}
.card .pricePill .big{font-size:32px;font-weight:800}
.card .subtitle{color:var(--muted); font-weight:600}
.card hr{border:0;border-top:1px solid #e6e8eb;margin:18px 0}
.disclaimer{margin-top:12px;font-size:14px;line-height:1.35;color:#111}
  /* --- Chip safe-area so content never scrolls under it --- */
:root{ --chipH: 36px }

.chip{ 
  position:fixed;
  top:10px; right:10px;
  background:#134c07; color:#fff;
  border-radius:999px;
  padding:6px 10px;
  font-size:12px;
  font-weight:600;
  box-shadow:0 2px 6px rgba(0,0,0,.12);
  z-index:1001;
  opacity:.9;
  transform:scale(0.9);
}
.chip.show{ opacity:1; transform:translateY(0); }

/* --- chip safe-area + visible white band (final fix) --- */
:root{ --chipH: 36px; --safeTop: calc(var(--chipH) + 14px); }

#chipSafe{
  position:fixed;
  top:0; left:0; right:0;
  height:var(--safeTop);
  background:#fff;
  box-shadow:0 1px 0 rgba(0,0,0,.06);
  z-index:1000;
  pointer-events:none;
}

/* shift all body content below the white band */
body.has-chip{
  padding-top:var(--safeTop);
}
/* keep chip above the white bar */
.chip{ z-index:1001; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
</head>
<body>
  <div id="chipSafe" hidden></div>
  <div id="userChip" class="chip" hidden></div>

<!-- Splash -->
<section id="splash" class="vh fade">
  <div class="inner">
    <img class="logo" src="logo.png" alt="RateHound">
  </div>
</section>

<!-- Signup landing -->
<section id="signup" class="vh">
  <div class="inner">
    <h1>Get ready to save some money on your utilities!</h1>
    <input class="field" id="name" placeholder="Full name" autocomplete="name" inputmode="text">
    <input class="field" id="phone" placeholder="Phone" autocomplete="tel" inputmode="tel">
    <input class="field" id="email" placeholder="Email" type="email" autocomplete="email">
    <button class="btn" id="signUpBtn" disabled>Sign up</button>
    <p class="hint">Demo only. No data is sent or stored.</p>
  </div>
</section>

<!-- PAGE 3 — Utility choice -->
<section id="utility" class="vh">
  <div class="inner">
    <h1>Save on your...</h1>
    <button class="btn tall selectable" id="chooseElectric">Electric Bill</button>
    <button class="btn tall selectable" id="chooseGas">Gas Bill</button>
    <p class="utilityHint">Choose one or both.</p>
    <button class="btn" id="fetchUtilities">Almost done!</button>
  </div>
</section>

<!-- PAGE 4 — Account intake -->
<section id="upload" class="vh">
  <div class="inner">
    <h1 id="uploadTitle">Provide your electric account information.</h1>

    <!-- three vertical method choices -->
    <button class="method" id="mBtnAI">AI Assist</button>
    <button class="method" id="mBtnUpload">Upload/Take Pic Of Bill</button>
    <button class="method" id="mBtnManual">Enter Manually</button>

    <!-- panels (only one shown at a time) -->
    <div id="m-manual" class="panel" hidden>
      <input class="field" id="acctName"  placeholder="Account name">
      <input class="field" id="acctNumber" placeholder="Account number">
      <input class="field" id="serviceAddr" placeholder="Service address">
    </div>

    <div id="m-upload" class="panel" hidden>
      <input id="billFile" type="file" accept="image/*,application/pdf" aria-label="Upload bill image or PDF">
      <img id="preview" class="preview" alt="Bill preview">
    </div>

    <div id="m-ai" class="panel" hidden>
      <p class="hint">Demo only. Tapping “AI Assist” marks this step as ready.</p>
    </div>

    <button class="btn" id="continueUpload">Continue</button>
    <p class="hint">Demo only. No data is sent or stored.</p>
  </div>
</section>

<!-- RESULTS (replaces #offer) -->
<section id="results" class="vh" style="display:none">
  <div class="inner" id="resultsInner"></div>
</section>

<!-- Loader Page -->
<section id="loader" class="vh">
  <div id="lottieContainer"></div>
</section>
  
  <!-- Toast container (for demo notifications) -->
<div id="toasts" aria-live="polite" aria-atomic="true"></div>
  
<!-- Manual-entry tip (electric only) -->
<div id="manualTip" class="modal" role="dialog" aria-modal="true" aria-labelledby="tipTitle">
  <div class="box">
    <button class="close" aria-label="Close tip" id="tipClose">×</button>
    <h3 id="tipTitle">Heads up</h3>
    <p>Customer Number must begin with <strong>080</strong>.</p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  /* ---------- splash → signup ---------- */
  const splash = document.getElementById('splash');
  const signup = document.getElementById('signup');

  setTimeout(() => {
    splash.classList.add('out');
    setTimeout(() => {
      splash.style.display = 'none';
      signup.classList.add('show');
    }, 450);
  }, 2300);

  splash.addEventListener('click', () => {
    splash.classList.add('out');
    setTimeout(() => {
      splash.style.display = 'none';
      signup.classList.add('show');
    }, 250);
  });

  /* ---------- signup btn enable ---------- */
  const signUpBtn  = document.getElementById('signUpBtn');
  const nameInput  = document.getElementById('name');
  const phoneInput = document.getElementById('phone');
  const emailInput = document.getElementById('email');

  function checkSignupFields(){
    signUpBtn.disabled = !(nameInput.value.trim() && phoneInput.value.trim() && emailInput.value.trim());
  }
  [nameInput, phoneInput, emailInput].forEach(el => el.addEventListener('input', checkSignupFields));
  checkSignupFields();
  renderUserChip();
  function renderUserChip(){
  const chip = document.getElementById('userChip');
  try{
    const user = JSON.parse(sessionStorage.getItem('rh_user') || '{}');
  if (user && user.email) {
  chip.textContent = `Signed in as ${user.email}`;
  chip.hidden = false;

  // Reserve space under the chip so content doesn't scroll beneath it
 document.body.classList.add('has-chip');
document.getElementById('chipSafe').hidden = false;   // unhide white safe area
  // animate in
  requestAnimationFrame(() => chip.classList.add('show'));
}
  } catch(e){
    // ignore
  }
}
  
  /* ---------- shadow account + toast helpers (demo only) ---------- */
const APP_LINK = '#'; // replace with real store link when ready

function createShadowAccount(){
  const user = {
    id: 'demo_' + Date.now(),
    name:  document.getElementById('name')?.value.trim() || '',
    phone: document.getElementById('phone')?.value.trim() || '',
    email: document.getElementById('email')?.value.trim() || '',
    createdAt: new Date().toISOString()
  };
  try { sessionStorage.setItem('rh_user', JSON.stringify(user)); } catch(e){}
  renderUserChip(); // <-- show/update chip immediately
  return user;
}

function showToast(html, ms=4000){
  const wrap = document.getElementById('toasts');
  if (!wrap) return;
  const t = document.createElement('div');
  t.className = 'toast';
  t.innerHTML = html;
  wrap.appendChild(t);
  requestAnimationFrame(() => t.classList.add('show'));
  setTimeout(() => {
    t.classList.remove('show');
    setTimeout(() => t.remove(), 250);
  }, ms);
}

function sendDemoWelcome(user){
  // Simulate SMS/Email with toasts (and console for devs)
  console.log('[DEMO SMS] Welcome to RateHound,', user.name, 'Username:', user.email);
  console.log('[DEMO EMAIL] Welcome to RateHound →', user.email);

  showToast('Welcome to RateHound, ' + (user.name || 'there') + '!');
  showToast('Your username is <strong>' + user.email + '</strong>.', 4000);
  showToast('Grab the app: <a href="'+APP_LINK+'" target="_blank" rel="noopener">RateHound App</a>', 7000);
}

  /* ---------- utility choice ---------- */
  const sel   = { electric:false, gas:false };
  const eBtn  = document.getElementById('chooseElectric');
  const gBtn  = document.getElementById('chooseGas');
  const fetchU= document.getElementById('fetchUtilities');

  function refreshFetch(){
    fetchU.classList.toggle('enabled', sel.electric || sel.gas);
  }
  eBtn.addEventListener('click', () => { sel.electric = !sel.electric; eBtn.classList.toggle('selected', sel.electric); refreshFetch(); });
  gBtn.addEventListener('click', () => { sel.gas      = !sel.gas;      gBtn.classList.toggle('selected', sel.gas);      refreshFetch(); });

signUpBtn.addEventListener('click', () => {
  if (signUpBtn.disabled) return;

  // 1) Create shadow account (demo-only)
  const user = createShadowAccount();

  // 2) Fire demo notifications (toasts + console)
  sendDemoWelcome(user);

  // 3) Proceed to utility selection
  signup.classList.remove('show');
  document.getElementById('utility').classList.add('show');
  window.scrollTo(0,0);
});

  /* ---------- intake ---------- */
  const uploadPage  = document.getElementById('upload');
  const utilityPage = document.getElementById('utility');
  const titleEl     = document.getElementById('uploadTitle');

  const mBtns = {
    manual: document.getElementById('mBtnManual'),
    upload: document.getElementById('mBtnUpload'),
    ai:     document.getElementById('mBtnAI'),
  };
  const panels = {
    manual: document.getElementById('m-manual'),
    upload: document.getElementById('m-upload'),
    ai:     document.getElementById('m-ai'),
  };

  const manualName  = document.getElementById('acctName');
  const manualNum   = document.getElementById('acctNumber');
  const manualAddr  = document.getElementById('serviceAddr');
  const fileInput   = document.getElementById('billFile');
  const previewEl   = document.getElementById('preview');
  const continueBtn = document.getElementById('continueUpload');

  const manualTip = document.getElementById('manualTip');
  const tipClose  = document.getElementById('tipClose');

  let uploadQueue = [];
  let uploadIndex = 0;
  let currentMethod = null;
  let tipSnoozed = false;

  function setUploadTitleFor(kind){
    titleEl.textContent = (kind === 'electric')
      ? 'Provide your electric account information.'
      : (kind === 'gas')
        ? 'Now provide your gas account information.'
        : 'Upload your bill';
  }

  function enableContinue(){ continueBtn.classList.add('enabled'); continueBtn.style.opacity='1'; continueBtn.style.pointerEvents='auto'; }
  function disableContinue(){ continueBtn.classList.remove('enabled'); continueBtn.style.opacity='.5'; continueBtn.style.pointerEvents='none'; }

  function resetPanels(){
    Object.values(panels).forEach(p => p.hidden = true);
    Object.values(mBtns).forEach(b => b.classList.remove('selected'));
    manualName.value = ''; manualNum.value = ''; manualAddr.value = '';
    if (fileInput) fileInput.value = '';
    if (previewEl) previewEl.style.display = 'none';
    currentMethod = null;
    tipSnoozed = false;
    disableContinue();
  }

  function selectMethod(which){
    resetPanels();
    currentMethod = which;
    mBtns[which].classList.add('selected');
    panels[which].hidden = false;
    validateUpload();
  }

  mBtns.manual.addEventListener('click', () => selectMethod('manual'));
  mBtns.upload.addEventListener('click', () => selectMethod('upload'));
  mBtns.ai.addEventListener('click', () => { resetPanels(); currentMethod='ai'; mBtns.ai.classList.add('selected'); panels.ai.hidden=false; enableContinue(); });

  tipClose.addEventListener('click', () => {
    manualTip.classList.remove('show');
    document.body.classList.remove('modal-open');
    tipSnoozed = true;
    setTimeout(() => manualNum?.focus({ preventScroll:true }), 50);
  });

  function validateUpload(){
    if (currentMethod === 'manual'){
      const nameOk = manualName.value.trim();
      const numVal = manualNum.value.trim();
      const addrOk = manualAddr.value.trim();

      let electricRuleOk = true;
      if (uploadQueue[uploadIndex] === 'electric'){
        const ok080 = numVal.startsWith('080');
        electricRuleOk = ok080;
        manualAddr.disabled = !ok080;
      } else {
        manualAddr.disabled = false;
      }
      return (nameOk && numVal && addrOk && electricRuleOk) ? enableContinue() : disableContinue();
    }
    if (currentMethod === 'upload'){
      const ok = !!fileInput.files?.[0];
      return ok ? enableContinue() : disableContinue();
    }
    disableContinue();
  }

  [manualName, manualNum, manualAddr].forEach(el => el?.addEventListener('input', validateUpload));
  manualNum.addEventListener('focus', () => {
    if (uploadQueue[uploadIndex] === 'electric' && !manualNum.value.startsWith('080') && !tipSnoozed){
      manualTip.classList.add('show'); document.body.classList.add('modal-open');
    }
  });
  manualNum.addEventListener('input', () => {
    if (uploadQueue[uploadIndex] === 'electric'){
      const ok = manualNum.value.startsWith('080');
      manualAddr.disabled = !ok;
      if (ok){ manualTip.classList.remove('show'); document.body.classList.remove('modal-open'); tipSnoozed=false; }
      else if (!tipSnoozed && !manualTip.classList.contains('show')){ manualTip.classList.add('show'); document.body.classList.add('modal-open'); }
    }
    validateUpload();
  });
  manualNum.addEventListener('blur', () => { tipSnoozed = false; });

  fileInput?.addEventListener('change', () => {
    const f = fileInput.files?.[0];
    if (!f){ previewEl.style.display='none'; return validateUpload(); }
    if (f.type.startsWith('image/')){ previewEl.src = URL.createObjectURL(f); previewEl.style.display='block'; }
    else { previewEl.style.display='none'; }
    validateUpload();
  });

  fetchU.addEventListener('click', () => {
    if (!(sel.electric || sel.gas)) return;
    uploadQueue = []; if (sel.electric) uploadQueue.push('electric'); if (sel.gas) uploadQueue.push('gas');
    uploadIndex = 0;
    setUploadTitleFor(uploadQueue[0]);
    continueBtn.textContent = (uploadQueue.length === 2 && uploadQueue[0] === 'electric') ? 'Continue to gas account' : 'Fetch my savings!';
    resetPanels();
    utilityPage.classList.remove('show'); uploadPage.classList.add('show'); window.scrollTo(0,0);
  });

  continueBtn.addEventListener('click', () => {
    if (!continueBtn.classList.contains('enabled')) return;

    uploadIndex++;
    if (uploadIndex < uploadQueue.length){
      setUploadTitleFor(uploadQueue[uploadIndex]);
      continueBtn.textContent = 'Fetch my savings!';
      resetPanels();
      window.scrollTo(0,0);
      return;
    }

    // finished → show loader
    document.getElementById('manualTip')?.classList.remove('show');
    document.body.classList.remove('modal-open');
    document.getElementById('utility').classList.remove('show');
    document.getElementById('upload').classList.remove('show');
    document.getElementById('loader').classList.add('show');

    // single Lottie init
    if (window.lottie && !window.__loaderAnim){
      window.__loaderAnim = lottie.loadAnimation({
        container: document.getElementById('lottieContainer'),
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: 'loader.json'
      });
    } else if (window.__loaderAnim){
      window.__loaderAnim.play();
      window.__loaderAnim.resize && window.__loaderAnim.resize();
    }

    window.scrollTo(0,0);

    setTimeout(() => {
      const currentKind = uploadQueue[uploadIndex] || 'electric';
      showLoaderThen(currentKind);
      if (uploadIndex + 1 < uploadQueue.length) uploadIndex++;
    }, 4000);
  });   // <-- closes DOMContentLoaded
 
function showLoaderThen(kind){
  const results = document.getElementById('results');
  const box     = document.getElementById('resultsInner');

  // Demo data
  const planName   = 'ClearGuarantee9Plus';
  const ptc        = '9.39¢ / kWh';
  const newRate    = '4.79¢ / kWh';
  const term       = '9 Months';
  const etf        = '$150';
  const estSavings = '45.1%';

  box.innerHTML = `
    <div class="card">
      <div class="yellowBox--sm">Price to Compare: ${ptc}</div>
      <hr>
      <div class="leadGreen" style="margin:8px 0 10px">Here's the lowest rate we found for you.</div>

      <div class="yellowBox--lg" style="margin:6px 0 16px">
        <div class="big">${newRate}</div>
      </div>

      <div style="margin:10px 0 6px">
        <div style="font-weight:800;color:#134c07">Plan:</div>
        <div style="font-size:18px">${planName}</div>
      </div>
      <div class="row2" style="margin-top:8px">
        <div class="blk"><div style="font-weight:800;color:#134c07">Contract Term</div>${term}</div>
        <div class="blk"><div style="font-weight:800;color:#134c07">Early Termination Fee</div>${etf}</div>
      </div>

      <div class="yellowBox--lg" style="margin:18px 0 6px; font-size:18px; font-weight:800;">
  Estimated Savings: <span class="big" style="font-size:inherit; font-weight:inherit;">${estSavings}</span>
</div>

      <button id="ctaSwitch" class="btn-cta">Switch me to this plan!</button>

      <hr style="margin:18px 0 10px">
      <div class="supplier" style="margin-top:0">
        <img src="clearwater logo.png" alt="clearwater logo.png" style="height:40px">
        <span style="font-weight:800;color:#134c07">Clearview Energy</span>
      </div>
      <div class="links" style="margin-top:12px">
        <a href="#">Clearview Energy Terms &amp; Conditions</a><br>
        <a href="#">RateHound Terms of Service</a>
      </div>
      <div class="disclaimer" style="margin-top:12px">
        This rate will be effective following the first billing date after successful enrollment.
      </div>
    </div>
  `;

  // Hide loader, show results
  document.getElementById('loader').classList.remove('show');
  results.style.display = 'flex';

  // Demo CTA
  const btn = box.querySelector('#ctaSwitch');
  btn && btn.addEventListener('click', () =>
    (window.showToast ? showToast('Great — we’ll start the switch (demo).', 4200) : alert('Great — we’ll start the switch (demo).'))
  );
}
});  // closes DOMContentLoaded
</script>
</body>
</html>
