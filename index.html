<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RateHound</title>
<meta name="theme-color" content="#134c07">
<style>
  :root{--brand:#134c07;--ink:#134c07;--muted:#6b7280;--border:#134c07}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Arial}

  /* full-viewport helpers (iOS-safe) */
  .vh{height:100vh}
  @supports (height:100dvh){ .vh{height:100dvh} }
  @supports (height:100svh){ .vh{height:100svh} }

  /* SPLASH */
  #splash{
    background:var(--brand); color:#fff;
    display:flex; align-items:center; justify-content:center; text-align:center;
  }
  #splash .inner{width:90%;max-width:420px;display:flex;flex-direction:column;gap:24px;align-items:center}
  .logo{width:180px;height:auto;display:block}

  /* cross-fade */
  .fade{opacity:1;transition:opacity .45s ease}
  .fade.out{opacity:0;pointer-events:none}

  /* SIGNUP */
  #signup{background:#fff; color:var(--ink); display:none}
  #signup.show{display:flex}
  #signup .inner{margin:0 auto; width:min(92%,420px); padding:28px 16px; display:flex; flex-direction:column; gap:14px}
  #signup .inner h1{
    margin:0 0 12px;font-size:26px;font-weight:700;text-align:center;color:var(--ink);
  }
  .field{
    width:100%;padding:12px 14px;border:2px solid var(--border);border-radius:12px;background:#fff;color:var(--ink);
    font-size:16px;box-sizing:border-box;
  }
  .btn{
    width:100%;padding:14px 18px;border:2px solid var(--brand);border-radius:999px;background:#fff;color:var(--brand);
    font-weight:700;text-align:center;cursor:pointer;
  }
  /* Sign Up button */
  #signUpBtn{
    background:var(--brand);color:#fff;font-size:20px;padding:16px 20px;border:none;border-radius:999px;font-weight:700;text-align:center;cursor:pointer;
  }
  #signUpBtn:active{background:#0f3a05;transform:scale(.98)}
  .btn:active{transform:scale(.99)}
  .hint{color:var(--muted); font-size:12px; text-align:center; margin-top:6px}

  /* PAGE 3 — Utility choice */
  #utility{background:#fff;color:var(--ink);display:none}
  #utility.show{display:flex}
  #utility .inner{
    margin:0 auto; width:min(92%,420px); padding:28px 16px;
    display:flex; flex-direction:column; gap:16px; justify-content:center; min-height:100vh;
    margin-top:-15vh;
  }
  #utility h1{margin:0 0 12px; font-size:26px; font-weight:700; text-align:center; color:var(--ink);}
  .btn.tall{
    height:8vh; display:flex; align-items:center; justify-content:center;
    border:2px solid var(--brand); background:#fff; color:var(--brand);
    border-radius:12px; font-weight:600; font-size:18px; width:100%;
  }
  .btn.selectable{background:#fff;color:var(--brand);border:2px solid var(--brand)}
  .btn.selectable.selected{background:var(--brand);color:#fff}

  .utilityHint{color:var(--muted); text-align:center; margin-top:6px}
  #fetchUtilities{
    margin-top:16px;background:var(--brand);color:#fff;border:none;border-radius:999px;font-size:20px;padding:16px 20px;
    opacity:.5;pointer-events:none;
  }
  #fetchUtilities.enabled{opacity:1;pointer-events:auto}

  /* PAGE 4 — Account intake */
  #upload{background:#fff;color:var(--ink);display:none}
  #upload.show{display:flex}
  #upload .inner{
    margin:0 auto; width:min(92%,420px); padding:28px 16px;
    display:flex; flex-direction:column; gap:14px; justify-content:flex-start; min-height:100vh;
  }
  #upload h1{margin:0 0 8px; font-size:26px; font-weight:700; text-align:center}

  .method{
    width:100%; height:8vh; min-height:64px; display:flex; align-items:center; justify-content:center;
    border:2px solid var(--brand); background:#fff; color:var(--brand); border-radius:12px; font-weight:600; font-size:18px; margin-top:10px;
  }
  .method.selected{background:var(--brand);color:#fff}

  .panel[hidden]{display:none}
  .preview{display:none; width:100%; max-height:300px; object-fit:contain; border:1px solid var(--border); border-radius:8px}

  #continueUpload{
    background:var(--brand); color:#fff; border:none; border-radius:999px;
    font-size:20px; padding:16px 20px; opacity:.5; pointer-events:none;
  }
  #continueUpload.enabled{opacity:1; pointer-events:auto}

  /* Modal tip */
  .modal{
    position:fixed; inset:0; display:none; place-items:center; background:#0008; z-index:50; opacity:0; transition:opacity .3s ease;
  }
  .modal.show{display:grid;opacity:1}
  .modal .box{
    background:#fff; color:var(--ink); width:min(92%,420px); border-radius:12px; padding:16px 16px 12px; border:2px solid var(--border); position:relative;
  }
  .modal .close{
    position:absolute; top:10px; right:12px; border:0; background:transparent; font-size:22px; line-height:1; cursor:pointer; color:var(--ink);
  }
  .modal h3{margin:0 0 8px; font-size:18px}
  body.modal-open{overflow:hidden}
#loader {
  background: #006400; /* solid green */
  color: #fff;
  display: none;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}
#loader.show {
  display: flex;
}
#lottieLoader {
  width: 200px;
  height: 200px;
}
  /* PAGE 5 – Offer */
  #offer{background:#f6f7f8;color:var(--ink);display:none}
  #offer.show{display:flex}
  #offer .inner{margin:0 auto;width:min(92%,420px);padding:28px 16px;display:flex;flex-direction:column;gap:16px;min-height:100vh}
  .card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:20px;box-shadow:0 1px 2px rgba(0,0,0,.03)}
  .card h2{margin:0 0 8px;font-size:22px}
  .compareBox{background:#fff8cc;border-left:4px solid #f2c200;border-radius:10px;padding:10px 12px;font-weight:600}
  .kv{display:flex;justify-content:space-between;align-items:center;margin:14px 0}
  .kv .big{font-size:28px;font-weight:800}
  .kv small{display:block;font-weight:600;color:var(--muted)}
  .row2{display:flex;gap:20px;margin-top:8px}
  .row2 .blk{flex:1}
  .supplier{display:flex;align-items:center;gap:12px;margin-top:14px;padding-top:12px;border-top:1px solid #e6e8eb}
  .links a{color:#2d7cf6;text-decoration:none}
  .btn--outline{background:#fff;color:var(--brand);border:2px solid var(--brand);border-radius:999px;padding:12px 16px;font-weight:700}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
</head>
<body>

<!-- Splash -->
<section id="splash" class="vh fade">
  <div class="inner">
    <img class="logo" src="logo.png" alt="RateHound">
  </div>
</section>

<!-- Signup landing -->
<section id="signup" class="vh">
  <div class="inner">
    <h1>Get ready to save some money!</h1>
    <input class="field" id="name" placeholder="Full name" autocomplete="name" inputmode="text">
    <input class="field" id="phone" placeholder="Phone" autocomplete="tel" inputmode="tel">
    <input class="field" id="email" placeholder="Email" type="email" autocomplete="email">
    <button class="btn" id="signUpBtn">Sign up</button>
    <p class="hint">Demo only. No data is sent or stored.</p>
  </div>
</section>

<!-- PAGE 3 — Utility choice -->
<section id="utility" class="vh">
  <div class="inner">
    <h1>Save me money on my...</h1>
    <button class="btn tall selectable" id="chooseElectric">Electric Bill</button>
    <button class="btn tall selectable" id="chooseGas">Gas Bill</button>
    <p class="utilityHint">Choose one or both.</p>
    <button class="btn" id="fetchUtilities">One more step!</button>
  </div>
</section>

<!-- PAGE 4 — Account intake -->
<section id="upload" class="vh">
  <div class="inner">
    <h1 id="uploadTitle">Let’s start with your electric account</h1>

    <!-- three vertical method choices -->
    <button class="method" id="mBtnAI">AI Assist</button>
    <button class="method" id="mBtnUpload">Upload/Take Pic Of Bill</button>
    <button class="method" id="mBtnManual">Enter Manually</button>

    <!-- panels (only one shown at a time) -->
    <div id="m-manual" class="panel" hidden>
      <input class="field" id="acctName"  placeholder="Account name">
      <input class="field" id="acctNumber" placeholder="Account number">
      <input class="field" id="serviceAddr" placeholder="Service address">
    </div>

    <div id="m-upload" class="panel" hidden>
      <input id="billFile" type="file" accept="image/*,application/pdf" aria-label="Upload bill image or PDF">
      <img id="preview" class="preview" alt="Bill preview">
    </div>

    <div id="m-ai" class="panel" hidden>
      <p class="hint">Demo only. Tapping “AI Assist” marks this step as ready.</p>
    </div>

    <button class="btn" id="continueUpload">Continue</button>
    <p class="hint">Demo only. No data is sent or stored.</p>
  </div>
</section>

<!-- PAGE 5 — Offer (placed AFTER other pages to avoid skipping flow) -->
<section id="offer" class="vh">
  <div class="inner">
    <div class="card">
      <h2>Your Selected Plan</h2>

      <div class="compareBox">
        <strong>Price to Compare:</strong> 9.39¢ / kWh
      </div>

      <div class="kv">
        <div class="big">$4.79</div>
        <small>per kWh</small>
      </div>

      <div class="row2">
        <div class="blk">
          <strong>Contract Term</strong><br>9 Months
        </div>
        <div class="blk">
          <strong>Early Termination Fee</strong><br>$150
        </div>
      </div>

      <div class="supplier">
        <img src="OHGE.png" alt="Supplier Logo" style="height:40px">
        <span>Clearview Energy</span>
      </div>

      <div class="links">
        <a href="#">Supplier Terms &amp; Conditions</a><br>
        <a href="#">RateHound Terms of Service</a>
      </div>
    </div>
  </div>
</section>
  <!-- Loader Page -->
<section id="loader" class="page" style="background:#0a0;display:none;align-items:center;justify-content:center;height:100vh;">
  <div id="lottieContainer" style="width:200px;height:200px;"></div>
</section>

<!-- Manual-entry tip (electric only) -->
<div id="manualTip" class="modal" role="dialog" aria-modal="true" aria-labelledby="tipTitle">
  <div class="box">
    <button class="close" aria-label="Close tip" id="tipClose">×</button>
    <h3 id="tipTitle">Heads up</h3>
    <p>Customer Number must begin with <strong>080</strong>.</p>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  /* -------------------------------------------------
   * splash → signup
   * ------------------------------------------------- */
  const splash = document.getElementById('splash');
  const signup = document.getElementById('signup');

  // auto-transition after ~2.3s
  setTimeout(() => {
    splash.classList.add('out');
    setTimeout(() => { splash.style.display = 'none'; signup.classList.add('show'); }, 450);
  }, 2300);

  // tap to skip immediately
  splash.addEventListener('click', () => {
    splash.classList.add('out');
    setTimeout(() => { splash.style.display = 'none'; signup.classList.add('show'); }, 250);
  });

  // “Sign up” → utility choice
  const signUpBtn = document.getElementById('signUpBtn');
  signUpBtn?.addEventListener('click', () => {
    signup.classList.remove('show');
    document.getElementById('utility').classList.add('show');
    window.scrollTo(0,0);
  });

  /* -------------------------------------------------
   * PAGE 3 — utility choice
   * ------------------------------------------------- */
  const sel   = { electric:false, gas:false };
  const eBtn  = document.getElementById('chooseElectric');
  const gBtn  = document.getElementById('chooseGas');
  const fetchU= document.getElementById('fetchUtilities');

  function refreshFetch(){
    const any = sel.electric || sel.gas;
    fetchU.classList.toggle('enabled', any);
  }

  eBtn?.addEventListener('click', () => {
    sel.electric = !sel.electric;
    eBtn.classList.toggle('selected', sel.electric);
    refreshFetch();
  });

  gBtn?.addEventListener('click', () => {
    sel.gas = !sel.gas;
    gBtn.classList.toggle('selected', sel.gas);
    refreshFetch();
  });

  /* -------------------------------------------------
   * PAGE 4 — account intake (queue electric → gas)
   * ------------------------------------------------- */
  const uploadPage  = document.getElementById('upload');
  const utilityPage = document.getElementById('utility');
  const titleEl     = document.getElementById('uploadTitle');

  // method buttons + panels
  const mBtns = {
    manual: document.getElementById('mBtnManual'),
    upload: document.getElementById('mBtnUpload'),
    ai:     document.getElementById('mBtnAI'),
  };
  const panels = {
    manual: document.getElementById('m-manual'),
    upload: document.getElementById('m-upload'),
    ai:     document.getElementById('m-ai'),
  };

  // inputs used by validation
  const manualName  = document.getElementById('acctName');
  const manualNum   = document.getElementById('acctNumber');
  const manualAddr  = document.getElementById('serviceAddr');
  const fileInput   = document.getElementById('billFile');
  const previewEl   = document.getElementById('preview');
  const continueBtn = document.getElementById('continueUpload');

  // modal elements
  const manualTip = document.getElementById('manualTip');
  const tipClose  = document.getElementById('tipClose');

  let uploadQueue = [];          // e.g., ['electric','gas']
  let uploadIndex = 0;           // pointer into queue
  let currentMethod = null;
  let shownElectricTip = false;  // for the 080 tip (validation)
  let tipSnoozed = false;       // suppress re-opening the tip until blur/re-focus
  function setUploadTitleFor(kind){
    if (kind === 'electric') titleEl.textContent = "Let’s start with your electric account.";
    else if (kind === 'gas') titleEl.textContent = "Now for your gas account.";
    else titleEl.textContent = "Upload your bill";
  }

  function enableContinue(){
    continueBtn.classList.add('enabled');
    continueBtn.style.opacity = '1';
    continueBtn.style.pointerEvents = 'auto';
  }
  function disableContinue(){
    continueBtn.classList.remove('enabled');
    continueBtn.style.opacity = '.5';
    continueBtn.style.pointerEvents = 'none';
  }

  function resetPanels(){
    Object.values(panels).forEach(p => p.hidden = true);
    Object.values(mBtns).forEach(b => b.classList.remove('selected'));
    manualName.value = ''; manualNum.value = ''; manualAddr.value = '';
    if (fileInput){ fileInput.value = ''; }
    if (previewEl){ previewEl.style.display = 'none'; }
    currentMethod = null;
    shownElectricTip = false; // reset validation-tip guard for each step
    disableContinue();
  }

  function selectMethod(which){
    resetPanels();
    currentMethod = which;
    mBtns[which].classList.add('selected');
    panels[which].hidden = false;


    validateUpload();
  }

  // wire method buttons
  mBtns.manual?.addEventListener('click', () => selectMethod('manual'));
  mBtns.upload?.addEventListener('click', () => selectMethod('upload'));
  mBtns.ai?.addEventListener('click', () => {
    resetPanels();
    currentMethod = 'ai';
    mBtns.ai.classList.add('selected');
    panels.ai.hidden = false;
    enableContinue(); // AI assist marks ready in demo
  });

  // modal close handlers
 tipClose?.addEventListener('click', () => {
  manualTip.classList.remove('show');
  document.body.classList.remove('modal-open');
  tipSnoozed = true; // snooze until next blur/focus cycle
  setTimeout(() => manualNum?.focus({ preventScroll: true }), 50);
});
 
 // validation
function validateUpload(){
  if (currentMethod === 'manual'){
    const nameOk = manualName.value.trim();
    const numVal = manualNum.value.trim();
    const addrOk = manualAddr.value.trim();

    // Electric-only 080 rule: lock address until OK
    let electricRuleOk = true;
    if (uploadQueue[uploadIndex] === 'electric'){
      const ok080 = numVal.startsWith('080');
      electricRuleOk = ok080;
      manualAddr.disabled = !ok080;
    } else {
      manualAddr.disabled = false;
    }

    return (nameOk && numVal && addrOk && electricRuleOk)
      ? enableContinue()
      : disableContinue();
  }

  if (currentMethod === 'upload'){
    const ok = !!fileInput.files?.[0];
    return ok ? enableContinue() : disableContinue();
  }

  // AI panel: enabled via its click; keep disabled here
  disableContinue();
}

// Re-run validation on inputs
[manualName, manualNum, manualAddr].forEach(el =>
  el?.addEventListener('input', validateUpload)
);

// Show tip on focus if invalid (electric only)
manualNum?.addEventListener('focus', () => {
  if (
    uploadQueue[uploadIndex] === 'electric' &&
    !manualNum.value.startsWith('080') &&
    !tipSnoozed
  ) {
    manualTip.classList.add('show');
    document.body.classList.add('modal-open');
  }
});

// Enforce 080 while typing; lock address; auto-hide tip when valid
manualNum?.addEventListener('input', () => {
  if (uploadQueue[uploadIndex] === 'electric') {
    const ok = manualNum.value.startsWith('080');
    manualAddr.disabled = !ok;

    if (ok) {
      manualTip.classList.remove('show');
      document.body.classList.remove('modal-open');
      tipSnoozed = false; // reset once valid
    } else if (!tipSnoozed && !manualTip.classList.contains('show')) {
      manualTip.classList.add('show');
      document.body.classList.add('modal-open');
    }
  }
  validateUpload();
});

// Let the tip show again after leaving the field
manualNum?.addEventListener('blur', () => { tipSnoozed = false; });
  fileInput?.addEventListener('change', () => {
    const f = fileInput.files?.[0];
    if (!f){ previewEl.style.display = 'none'; return validateUpload(); }
    if (f.type.startsWith('image/')){
      previewEl.src = URL.createObjectURL(f);
      previewEl.style.display = 'block';
    } else {
      previewEl.style.display = 'none';
    }
    validateUpload();
  });

  // start intake flow after utility selection
  fetchU?.addEventListener('click', () => {
    if (!(sel.electric || sel.gas)) return;

    uploadQueue = [];
    if (sel.electric) uploadQueue.push('electric');
    if (sel.gas)      uploadQueue.push('gas');
    uploadIndex = 0;
tipSnoozed = false; // reset snooze state each time intake starts

setUploadTitleFor(uploadQueue[0]);

    // label depends on queue
    if (uploadQueue.length === 2 && uploadQueue[0] === 'electric'){
      continueBtn.textContent = 'Continue to gas account';
    } else {
      continueBtn.textContent = 'Fetch my savings!';
    }

    resetPanels(); // keeps disabled until valid

    utilityPage.classList.remove('show');
    uploadPage.classList.add('show');
    window.scrollTo(0,0);
  });

  // Continue → either next utility or finish to Offer
  continueBtn.addEventListener('click', () => {
    if (!continueBtn.classList.contains('enabled')) return;

    uploadIndex++;

    if (uploadIndex < uploadQueue.length){
      // now on gas
      setUploadTitleFor(uploadQueue[uploadIndex]);
      continueBtn.textContent = 'Fetch my savings!';
      resetPanels();
      window.scrollTo(0,0);
   } else {
  // finished → show loader first
  document.getElementById('manualTip')?.classList.remove('show');
  document.body.classList.remove('modal-open');

  document.getElementById('utility').classList.remove('show');
  document.getElementById('upload').classList.remove('show');
  document.getElementById('loader').classList.add('show'); // NEW loader page
  window.scrollTo(0,0);

  // after 2.5s → swap loader for Offer page
  setTimeout(() => {
    document.getElementById('loader').classList.remove('show');
    document.getElementById('offer').classList.add('show');
  }, 2500);
}
  });
});
</script>
</body>
</html>
