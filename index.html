<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RateHound</title>
<meta name="theme-color" content="#134c07">
<style>
  :root{--brand:#134c07;--ink:#134c07;--muted:#6b7280;--border:#134c07}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Arial}

  .vh{height:100vh}
  @supports (height:100dvh){ .vh{height:100dvh} }
  @supports (height:100svh){ .vh{height:100svh} }

  /* SPLASH */
  #splash{
    background:var(--brand); color:#fff;
    display:flex; align-items:center; justify-content:center; text-align:center;
  }
  #splash .inner{width:90%;max-width:420px;display:flex;flex-direction:column;gap:24px;align-items:center}
  .logo{width:180px;height:auto;display:block}

  .fade{opacity:1;transition:opacity .45s ease}
  .fade.out{opacity:0;pointer-events:none}

  /* SIGNUP */
  #signup{background:#fff;color:var(--ink);display:none}
  #signup.show{display:flex}
  #signup .inner{margin:0 auto;width:min(92%,420px);padding:28px 16px;display:flex;flex-direction:column;gap:14px}
  #signup .inner h1{margin:0 0 12px;font-size:26px;font-weight:700;text-align:center;color:var(--ink)}
  .field{width:100%;padding:12px 14px;border:2px solid var(--border);border-radius:12px;background:#fff;color:var(--ink);font-size:16px}

  #signUpBtn:disabled{opacity:.5;cursor:not-allowed}
  #signUpBtn{background:var(--brand);color:#fff;font-size:20px;padding:16px 20px;border:none;border-radius:999px;font-weight:700;cursor:pointer}
  #signUpBtn:active{background:#0f3a05;transform:scale(.98)}
  .btn:active{transform:scale(.99)}
  .hint{color:var(--muted);font-size:12px;text-align:center;margin-top:6px}

  /* Toasts */
  #toasts{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:8px;z-index:1000}
  .toast{background:#134c07;color:#fff;border-radius:999px;padding:10px 20px;box-shadow:0 3px 10px rgba(0,0,0,.15);font-size:14px;font-weight:500;white-space:nowrap;opacity:0;transform:translateY(10px);transition:opacity .25s ease,transform .25s ease}
  .toast.show{opacity:1;transform:translateY(0)}
  .toast a{color:#fff;text-decoration:underline;font-weight:600}

  /* UPLOAD (Account intake) */
  #upload{background:#fff;color:var(--ink);display:none}
  #upload.show{display:flex}
  #upload .inner{margin:0 auto;width:min(92%,420px);padding:28px 16px;display:flex;flex-direction:column;gap:16px;justify-content:flex-start;min-height:100vh;margin-top:5vh}
  #upload h1{margin:0 0 8px;font-size:26px;font-weight:700;text-align:center}
  .method{width:100%;height:8vh;min-height:64px;display:flex;align-items:center;justify-content:center;border:2px solid var(--brand);background:#fff;color:var(--brand);border-radius:12px;font-weight:600;font-size:18px;margin-top:10px}
  .method.selected{background:var(--brand);color:#fff}
  .panel[hidden]{display:none}
  .preview{display:none;width:100%;max-height:300px;object-fit:contain;border:1px solid var(--border);border-radius:8px}
  #continueUpload{background:var(--brand);color:#fff;border:none;border-radius:999px;font-size:20px;padding:16px 20px;opacity:.5;pointer-events:none}
  #continueUpload.enabled{opacity:1;pointer-events:auto}

  /* Loader page */
  #loader{position:fixed;inset:0;z-index:999;background:var(--brand)!important;display:none;justify-content:center;align-items:center;width:100%;height:100svh}
  #loader.show{display:flex}
  #lottieContainer, #lottieContainer>div, #lottieContainer canvas, #lottieContainer svg{background:transparent!important;width:100%!important;height:100%!important;display:block}

  /* RESULTS card */
  #results{background:#f6f7f8;color:var(--ink);display:none}
  #results .inner{margin:5vh auto 0;width:min(92%,420px);padding:28px 16px;display:flex;flex-direction:column;gap:16px}
  .card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:20px;box-shadow:0 1px 2px rgba(0,0,0,.03)}
  .card h2{margin:0 0 8px;font-size:22px}
  .links a{color:#2d7cf6;text-decoration:none}
  .disclaimer{margin-top:12px;font-size:14px;line-height:1.35;color:#111}

  .yellowBox--sm,.yellowBox--lg{background:#fff8cc;border-left:4px solid #f2c200;border-radius:10px;padding:12px;text-align:center;color:#134c07;font-weight:700;display:block;width:max-content;margin:0 auto}
  .yellowBox--lg .big{font-size:18px;font-weight:700;line-height:1.2}
  .leadGreen{color:#134c07;font-weight:800;font-size:24px;line-height:1.25;text-align:center}
  .row2{display:flex;gap:20px;margin-top:8px}
  .row2 .blk{flex:1}

  .btn-cta{background:#134c07;color:#fff;border:none;border-radius:999px;font-weight:800;padding:14px 18px;width:100%;margin-top:12px;cursor:pointer}
  .btn-cta:active{transform:scale(.99)}

  /* User chip + safe area */
  :root{--chipH:36px;--safeTop:calc(var(--chipH) + 14px)}
  #chipSafe{position:fixed;top:0;left:0;right:0;height:var(--safeTop);background:#fff;box-shadow:0 1px 0 rgba(0,0,0,.06);z-index:1000;pointer-events:none}
  body.has-chip{padding-top:var(--safeTop)}
  .chip{position:fixed;top:10px;right:10px;background:#134c07;color:#fff;border-radius:999px;padding:6px 10px;font-size:12px;font-weight:600;box-shadow:0 2px 6px rgba(0,0,0,.12);z-index:1001;opacity:.9;transform:scale(.9)}
  .chip.show{opacity:1;transform:translateY(0)}
</style>

<!-- libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.min.js"></script>
<script>pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.worker.min.js";</script>
<script src="https://unpkg.com/tesseract.js@4/dist/tesseract.min.js"></script>
</head>
<body>
  <div id="chipSafe" hidden></div>
  <div id="userChip" class="chip" hidden></div>

  <!-- Splash -->
  <section id="splash" class="vh fade">
    <div class="inner">
      <img class="logo" src="logo.png" alt="RateHound">
    </div>
  </section>

  <!-- Signup landing -->
  <section id="signup" class="vh">
    <div class="inner">
      <h1>Get ready to save on your electric bill!</h1>
      <input class="field" id="name"  placeholder="Full name" autocomplete="name"  inputmode="text">
      <input class="field" id="phone" placeholder="Phone"     autocomplete="tel"   inputmode="tel">
      <input class="field" id="email" placeholder="Email"     type="email"         autocomplete="email">
      <button class="btn" id="signUpBtn" disabled>Sign up</button>
      <p class="hint">Demo only. No data is sent or stored.</p>
    </div>
  </section>

  <!-- PAGE — Account intake -->
  <section id="upload" class="vh">
    <div class="inner">
      <h1 id="uploadTitle">Provide a copy of your most recent electric bill.</h1>

      <button class="method" id="mBtnUpload">Upload / Take Photo</button>

      <div id="m-upload" class="panel" hidden>
        <input id="billFile" type="file" accept="image/*,application/pdf" aria-label="Upload or take a photo of your bill" hidden>
        <img id="preview" class="preview" alt="Bill preview">
      </div>

      <button class="btn" id="continueUpload">Continue</button>
      <p class="hint">Demo only. No data is sent or stored.</p>
    </div>
  </section>

  <!-- RESULTS -->
  <section id="results" class="vh" style="display:none">
    <div class="inner" id="resultsInner"></div>
  </section>

  <!-- Loader Page -->
  <section id="loader" class="vh">
    <div id="lottieContainer"></div>
  </section>

  <!-- Toasts -->
  <div id="toasts" aria-live="polite" aria-atomic="true"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  /* ---------- splash → signup ---------- */
  const splash = document.getElementById('splash');
  const signup = document.getElementById('signup');

  setTimeout(() => {
    splash.classList.add('out');
    setTimeout(() => { splash.style.display = 'none'; signup.classList.add('show'); }, 450);
  }, 2300);

  splash.addEventListener('click', () => {
    splash.classList.add('out');
    setTimeout(() => { splash.style.display = 'none'; signup.classList.add('show'); }, 250);
  });

  /* ---------- signup enable ---------- */
  const signUpBtn  = document.getElementById('signUpBtn');
  const nameInput  = document.getElementById('name');
  const phoneInput = document.getElementById('phone');
  const emailInput = document.getElementById('email');

  function checkSignupFields(){
    signUpBtn.disabled = !(nameInput.value.trim() && phoneInput.value.trim() && emailInput.value.trim());
  }
  [nameInput, phoneInput, emailInput].forEach(el => el.addEventListener('input', checkSignupFields));
  checkSignupFields();

  renderUserChip();
  function renderUserChip(){
    const chip = document.getElementById('userChip');
    try{
      const user = JSON.parse(sessionStorage.getItem('rh_user') || '{}');
      if (user && user.email) {
        chip.textContent = Signed in as ${user.email};
        chip.hidden = false;
        document.body.classList.add('has-chip');
        document.getElementById('chipSafe').hidden = false;
        requestAnimationFrame(() => chip.classList.add('show'));
      }
    } catch(e){}
  }

  /* ---------- shadow account + toasts (demo) ---------- */
  const APP_LINK = '#';
  // GAS endpoint + optional shared secret
  const GAS_URL = 'https://script.google.com/macros/s/AKfycbyl5HwDc0MzkKZZsz1guTyvX0rOvjzMpB83ufmLtBmBVhqL5Wh3VBSaq-LCIJ7_hxsv/exec';     
  const RH_SHARED_SECRET = '9c7e51dff93b4c42ae4cdb1e8c4b9d21'; 

  function createShadowAccount(){
    const user = {
      id: 'demo_' + Date.now(),
      name:  document.getElementById('name')?.value.trim() || '',
      phone: document.getElementById('phone')?.value.trim() || '',
      email: document.getElementById('email')?.value.trim() || '',
      createdAt: new Date().toISOString()
    };
    try { sessionStorage.setItem('rh_user', JSON.stringify(user)); } catch(e){}
    renderUserChip();
    return user;
  }

  function showToast(html, ms=4000){
    const wrap = document.getElementById('toasts');
    if (!wrap) return;
    const t = document.createElement('div');
    t.className = 'toast';
    t.innerHTML = html;
    wrap.appendChild(t);
    requestAnimationFrame(() => t.classList.add('show'));
    setTimeout(() => { t.classList.remove('show'); setTimeout(() => t.remove(), 250); }, ms);
  }

  function sendDemoWelcome(user){
    console.log('[DEMO SMS] Welcome to RateHound,', user.name, 'Username:', user.email);
    console.log('[DEMO EMAIL] Welcome to RateHound →', user.email);
    showToast('Welcome to RateHound, ' + (user.name || 'there') + '!');
    showToast('Your username is <strong>' + user.email + '</strong>.', 4000);
    showToast('Grab the app: <a href="'+APP_LINK+'" target="_blank" rel="noopener">RateHound App</a>', 7000);
  }

  /* ---------- helpers (PDF/Images) ---------- */
  async function pdfFirstPageAsImage(file, scale = 1.4) {
    const buf = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: buf }).promise;
    const page = await pdf.getPage(1);
    const viewport = page.getViewport({ scale });
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = viewport.width; canvas.height = viewport.height;
    await page.render({ canvasContext: ctx, viewport }).promise;
    const blob = await new Promise(res => canvas.toBlob(res, 'image/png', 0.95));
    const dataUrl = canvas.toDataURL('image/png');
    return { blob, dataUrl };
  }

  async function blobToDataUrl(blob){
    return new Promise((res, rej) => {
      const fr = new FileReader();
      fr.onload = () => res(fr.result);
      fr.onerror = rej;
      fr.readAsDataURL(blob);
    });
  }

  async function downscaleImageBlob(blob, maxDim=1600, mime='image/jpeg', quality=0.82){
    const img = document.createElement('img');
    const url = URL.createObjectURL(blob);
    await new Promise(r => { img.onload = r; img.src = url; });
    const w=img.naturalWidth, h=img.naturalHeight;
    let nw=w, nh=h;
    if (Math.max(w,h)>maxDim){ const k=maxDim/Math.max(w,h); nw=Math.round(w*k); nh=Math.round(h*k); }
    const c=document.createElement('canvas'); c.width=nw; c.height=nh;
    c.getContext('2d').drawImage(img,0,0,nw,nh);
    return new Promise(res => c.toBlob(b => { URL.revokeObjectURL(url); res(b||blob); }, mime, quality));
  }

  // Send to Apps Script Vision endpoint (text-first error reporting)
  async function sendToAppsScriptVision({ imageBlob, userEmail }) {
  // Downscale if large, then convert to data URL
  const compact = imageBlob.size > 900000 ? await downscaleImageBlob(imageBlob) : imageBlob;
  const imageDataUrl = await blobToDataUrl(compact);

  const payload = { userEmail, imageDataUrl, token: RH_SHARED_SECRET };

  // Use text/plain to avoid CORS preflight
  const resp = await fetch(GAS_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
    body: JSON.stringify(payload)
  });

  const text = await resp.text(); // read text first for better errors
  let json;
  try {
    json = JSON.parse(text);
  } catch (e) {
    console.error('Apps Script returned non-JSON:', { status: resp.status, text });
    throw new Error(Server returned non-JSON (${resp.status}): ${text.slice(0,200)});
  }

  if (!json.ok) {
    console.error('Apps Script error payload:', json);
    throw new Error(json.error || Unknown server error (${resp.status}));
  }

  console.log('Apps Script fields:', json.fields);
  return json.fields;
}
// -------- Customer number: 20 digits starting with 080 --------
// Accepts spaces/newlines/OCR gaps between digits, then normalizes
function extract080x20(text) {
  const m = (text || '').match(/0\s*8\s*0(?:\s*\d){17}/i);
  if (!m) return '';
  const digits = m[0].replace(/\D/g, '');
  return /^080\d{17}$/.test(digits) ? digits : '';
}
  /* ---------- intake flow ---------- */
  signUpBtn.addEventListener('click', () => {
    if (signUpBtn.disabled) return;
    const user = createShadowAccount();
    sendDemoWelcome(user);
    signup.classList.remove('show');
    document.getElementById('upload').classList.add('show');
    uploadQueue = ['electric'];
    setUploadTitleFor('electric');
    selectMethod('upload');
    window.scrollTo(0,0);
  });

  const titleEl = document.getElementById('uploadTitle');
  const mBtns   = { upload: document.getElementById('mBtnUpload') };
  const panels  = { upload: document.getElementById('m-upload') };
  const fileInput   = document.getElementById('billFile');
  const previewEl   = document.getElementById('preview');
  const continueBtn = document.getElementById('continueUpload');

  let uploadQueue = [];
  let uploadIndex = 0;
  let currentMethod = null;
  let lastThumbUrl = null;

  function setUploadTitleFor(kind){
    titleEl.textContent = (kind === 'electric')
      ? 'Provide your electric account information.'
      : 'Upload your bill';
  }
  function enableContinue(){ continueBtn.classList.add('enabled'); continueBtn.style.opacity='1'; continueBtn.style.pointerEvents='auto'; }
  function disableContinue(){ continueBtn.classList.remove('enabled'); continueBtn.style.opacity='.5'; continueBtn.style.pointerEvents='none'; }
  function resetPanels(){
    Object.values(panels).forEach(p => p.hidden = true);
    Object.values(mBtns).forEach(b => b.classList.remove('selected'));
    if (fileInput) fileInput.value = '';
    if (previewEl) previewEl.style.display = 'none';
    currentMethod = null;
    disableContinue();
  }
  function selectMethod(which){
    resetPanels();
    currentMethod = which;
    mBtns[which].classList.add('selected');
    panels[which].hidden = false;
    validateUpload();
  }
  mBtns.upload.addEventListener('click', () => { selectMethod('upload'); fileInput.click(); });
  function validateUpload(){
    if (currentMethod === 'upload'){
      const ok = !!fileInput.files?.[0];
      return ok ? enableContinue() : disableContinue();
    }
    disableContinue();
  }

  fileInput?.addEventListener('change', async () => {
    const f = fileInput.files?.[0];
    if (lastThumbUrl) { URL.revokeObjectURL(lastThumbUrl); lastThumbUrl = null; }

    if (!f) {
      previewEl.style.display = 'none';
      document.getElementById('parsedOut')?.remove();
      disableContinue();
      return;
    }

    let ocrSource = f;
    if (f.type === 'application/pdf') {
      try {
        const { blob, dataUrl } = await pdfFirstPageAsImage(f, 1.4);
        previewEl.src = dataUrl; previewEl.style.display = 'block';
        ocrSource = blob;
      } catch (e) {
        console.error('PDF render failed:', e);
        previewEl.style.display = 'none';
      }
    } else {
      lastThumbUrl = URL.createObjectURL(f);
      previewEl.src = lastThumbUrl; previewEl.style.display = 'block';
    }

    let out = document.getElementById('parsedOut');
    if (!out) {
      out = document.createElement('pre');
      out.id = 'parsedOut';
      out.className = 'hint';
      out.style.whiteSpace = 'pre-wrap';
      document.getElementById('m-upload').appendChild(out);
    }
    out.textContent = '⏳ Reading your bill...';

    const timeout = new Promise((_, rej) => setTimeout(() => rej(new Error('Vision timeout')), 30000));

    try {
      const user = JSON.parse(sessionStorage.getItem('rh_user') || '{}');
      const userEmail = user && user.email ? String(user.email) : '';

      const fields = await Promise.race([
        sendToAppsScriptVision({ imageBlob: ocrSource, userEmail }),
        timeout
      ]);

      if (!fields || (!fields.customerNumber && !fields.name)) {
        out.textContent = '❌ Could not read bill details. Please retake or upload a clearer photo.';
        disableContinue();
        return;
      }

      out.textContent = [
        Customer number: ${fields.customerNumber || '(missing)'},
        Name: ${fields.name || ''},
        Address: ${fields.address || ''},
        Zip: ${fields.zip || ''},
        Bill period: ${fields.billPeriodEnd || ''}
      ].join('\n');

      window.__rh_fields = fields;
      enableContinue();

    } catch (err) {
  console.warn('Vision parse failed, using on-device OCR:', err);
  out.textContent = '⚠️ Server failed; using on-device OCR...';
  try {
    const text = await ocrImage(ocrSource);
    const num = extract080x20(text);
    if (!num) {
      out.textContent += '\n❌ Could not find a valid 080xxxxxxxxxxxxxxxxx number.';
      disableContinue();
      return;
    }

    const local = { 
      customerNumber: num,
      ...parseFields(text)
    };

    out.textContent = [
      Customer number: ${local.customerNumber},
      Name: ${local.name || ''},
      Address: ${local.address || ''},
      Zip: ${local.zip || ''},
      Bill period: ${local.billPeriodEnd || ''}
    ].join('\n');

    window.__rh_fields = local;
    enableContinue();
  } catch (e2) {
    out.textContent = '❌ Could not read the bill.';
    disableContinue();
  }
    return; // prevent any old fallthrough code from running
    }
  });

  /* ---------- fake results screen ---------- */
  continueBtn.addEventListener('click', () => {
    if (!continueBtn.classList.contains('enabled')) return;
    document.getElementById('upload').classList.remove('show');
    document.getElementById('loader').classList.add('show');

    if (window.lottie && !window.__loaderAnim){
      window.__loaderAnim = lottie.loadAnimation({
        container: document.getElementById('lottieContainer'),
        renderer: 'svg', loop: true, autoplay: true,
        path: 'loader.json'
      });
    } else if (window.__loaderAnim){
      window.__loaderAnim.play();
      window.__loaderAnim.resize && window.__loaderAnim.resize();
    }

    window.scrollTo(0,0);
    setTimeout(() => showLoaderThen(uploadQueue[uploadIndex] || 'electric'), 4000);
  });

  function showLoaderThen(kind){
    const results = document.getElementById('results');
    const box     = document.getElementById('resultsInner');

    const planName='ClearGuarantee9Plus', ptc='9.39¢ / kWh', newRate='4.79¢ / kWh', term='9 Months', etf='$150', estSavings='45.1%';

    box.innerHTML = 
      <div class="card">
        <div class="yellowBox--sm">Price to Compare: ${ptc}</div>
        <hr>
        <div class="leadGreen" style="margin:8px 0 10px">Here's the lowest rate we found for you.</div>
        <div class="yellowBox--lg ratePill"><div class="big">${newRate}</div></div>
        <div style="margin:10px 0 6px">
          <div style="font-weight:800;color:#134c07">Plan:</div>
          <div style="font-size:18px">${planName}</div>
        </div>
        <div class="row2" style="margin-top:8px">
          <div class="blk"><div style="font-weight:800;color:#134c07">Contract Term</div>${term}</div>
          <div class="blk"><div style="font-weight:800;color:#134c07">Early Termination Fee</div>${etf}</div>
        </div>
        <div class="yellowBox--lg savingsPill">Estimated Savings: <span class="big">${estSavings}</span></div>
        <button id="ctaSwitch" class="btn-cta">Switch me to this plan!</button>
        <hr style="margin:18px 0 10px">
        <div class="supplier" style="margin-top:0;display:flex;align-items:center;gap:12px;padding-top:12px;border-top:1px solid #e6e8eb">
          <img src="clearwater logo.png" alt="clearwater logo" style="height:40px">
          <span style="font-weight:800;color:#134c07">Clearview Energy</span>
        </div>
        <div class="links" style="margin-top:12px">
          <a href="#">Clearview Energy Terms &amp; Conditions</a><br>
          <a href="#">RateHound Terms of Service</a>
        </div>
        <div class="disclaimer" style="margin-top:12px">This rate will be effective following the first billing date after successful enrollment.</div>
      </div>;
    document.getElementById('loader').classList.remove('show');
    results.style.display = 'flex';
   box.querySelector('#ctaSwitch')?.addEventListener('click', () =>
  showToast('Great — we’ll start the switch (demo).', 4200)
);
  }

  /* ---- client-side parsing fallback ---- */
  function parseFields(text){
    const t = (text || "").replace(/\r/g, "");
  

  // -------- Customer number: 20 digits starting with 080 --------
// Accepts spaces, newlines, or OCR gaps between digits

const customerNumber = extract080x20(t);
const validCustomerNumber = !!customerNumber;
    const billBlockMatch = t.match(/Bill\s*for[:\s]*(.+?)(?:\n{2,}|Billing\s*Period|Bill\s*Date|Account\s*Number)/is);
    const billBlock = billBlockMatch ? billBlockMatch[1].trim() : "";
    const lines = billBlock.split(/\n/).map(s => s.trim()).filter(Boolean);

    const name   = lines[0] || "";
    const address = (lines.find(l => /^\d+[\sA-Za-z]/.test(l)) || lines[1] || "").replace(/\s{2,}/g," ").trim();

    const zipMatch =
      (lines.slice(-2).join(" ").match(/\b(\d{5})(?:-\d{4})?\b/)) ||
      (billBlock.match(/\b(\d{5})(?:-\d{4})?\b/));
    const zip = zipMatch ? zipMatch[1] : "";

    const bp = t.match(/Billing\s*Period[:\s]*([A-Za-z]{3,9}\s+\d{1,2})\s*(?:to|–|-|—)\s*([A-Za-z]{3,9}\s+\d{1,2})(?:,\s*(\d{4}))?/i);
    let billPeriodEnd = "";
    if (bp) {
      const right = bp[2];
      const year  = bp[3] || new Date().getFullYear();
      const endDate = new Date(${right}, ${year});
      billPeriodEnd = endDate.toLocaleString('en-US', { month: 'short', day: 'numeric' });
    }

    return { customerNumber, name, address, zip, billPeriodEnd, validCustomerNumber };
  }
});
</script>
</body>
</html><!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RateHound</title>
<meta name="theme-color" content="#134c07" />
<style>
  :root{--brand:#134c07;--ink:#134c07;--muted:#6b7280;--border:#134c07}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Arial}

  .vh{height:100vh}
  @supports(height:100dvh){.vh{height:100dvh}}
  @supports(height:100svh){.vh{height:100svh}}

  /* SPLASH */
  #splash{background:var(--brand);color:#fff;display:flex;align-items:center;justify-content:center;text-align:center}
  #splash .inner{width:90%;max-width:420px;display:flex;flex-direction:column;gap:24px;align-items:center}
  .logo{width:180px;height:auto;display:block}
  .fade{opacity:1;transition:opacity .45s ease}
  .fade.out{opacity:0;pointer-events:none}

  /* SIGNUP */
  #signup{background:#fff;color:var(--ink);display:none}
  #signup.show{display:flex}
  #signup .inner{margin:0 auto;width:min(92%,420px);padding:28px 16px;display:flex;flex-direction:column;gap:14px}
  #signup .inner h1{margin:0 0 12px;font-size:26px;font-weight:700;text-align:center;color:var(--ink)}
  .field{width:100%;padding:12px 14px;border:2px solid var(--border);border-radius:12px;background:#fff;color:var(--ink);font-size:16px}
  #signUpBtn:disabled{opacity:.5;cursor:not-allowed}
  #signUpBtn{background:var(--brand);color:#fff;font-size:20px;padding:16px 20px;border:none;border-radius:999px;font-weight:700;cursor:pointer}
  #signUpBtn:active{background:#0f3a05;transform:scale(.98)}
  .btn:active{transform:scale(.99)}
  .hint{color:var(--muted);font-size:12px;text-align:center;margin-top:6px}

  /* Toasts */
  #toasts{position:fixed;bottom:28px;left:50%;transform:translateX(-50%);display:flex;flex-direction:column;align-items:center;gap:8px;z-index:1000}
  .toast{background:#134c07;color:#fff;border-radius:999px;padding:10px 20px;box-shadow:0 3px 10px rgba(0,0,0,.15);font-size:14px;font-weight:500;white-space:nowrap;opacity:0;transform:translateY(10px);transition:opacity .25s ease,transform .25s ease}
  .toast.show{opacity:1;transform:translateY(0)}
  .toast a{color:#fff;text-decoration:underline;font-weight:600}

  /* UPLOAD */
  #upload{background:#fff;color:var(--ink);display:none}
  #upload.show{display:flex}
  #upload .inner{margin:0 auto;width:min(92%,420px);padding:28px 16px;display:flex;flex-direction:column;gap:16px;justify-content:flex-start;min-height:100vh;margin-top:5vh}
  #upload h1{margin:0 0 8px;font-size:26px;font-weight:700;text-align:center}
  .method{width:100%;height:8vh;min-height:64px;display:flex;align-items:center;justify-content:center;border:2px solid var(--brand);background:#fff;color:var(--brand);border-radius:12px;font-weight:600;font-size:18px;margin-top:10px;cursor:pointer}
  .method.selected{background:var(--brand);color:#fff}
  .panel[hidden]{display:none}
  .preview{display:none;width:100%;max-height:300px;object-fit:contain;border:1px solid var(--border);border-radius:8px}
  #continueUpload{background:var(--brand);color:#fff;border:none;border-radius:999px;font-size:20px;padding:16px 20px;opacity:.5;pointer-events:none}
  #continueUpload.enabled{opacity:1;pointer-events:auto}

  /* Loader */
  #loader{position:fixed;inset:0;z-index:999;background:var(--brand)!important;display:none;justify-content:center;align-items:center;width:100%;height:100svh}
  #loader.show{display:flex}
  #lottieContainer, #lottieContainer>div, #lottieContainer canvas, #lottieContainer svg{background:transparent!important;width:100%!important;height:100%!important;display:block}

  /* RESULTS */
  #results{background:#f6f7f8;color:var(--ink);display:none}
  #results .inner{margin:5vh auto 0;width:min(92%,420px);padding:28px 16px;display:flex;flex-direction:column;gap:16px}
  .card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:20px;box-shadow:0 1px 2px rgba(0,0,0,.03)}
  .card h2{margin:0 0 8px;font-size:22px}
  .links a{color:#2d7cf6;text-decoration:none}
  .disclaimer{margin-top:12px;font-size:14px;line-height:1.35;color:#111}

  .yellowBox--sm,.yellowBox--lg{background:#fff8cc;border-left:4px solid #f2c200;border-radius:10px;padding:12px;text-align:center;color:#134c07;font-weight:700;display:block;width:max-content;margin:0 auto}
  .yellowBox--lg .big{font-size:18px;font-weight:700;line-height:1.2}
  .leadGreen{color:#134c07;font-weight:800;font-size:24px;line-height:1.25;text-align:center}
  .row2{display:flex;gap:20px;margin-top:8px}
  .row2 .blk{flex:1}

  .btn-cta{background:#134c07;color:#fff;border:none;border-radius:999px;font-weight:800;padding:14px 18px;width:100%;margin-top:12px;cursor:pointer}
  .btn-cta:active{transform:scale(.99)}

  /* User chip + safe area */
  :root{--chipH:36px;--safeTop:calc(var(--chipH) + 14px)}
  #chipSafe{position:fixed;top:0;left:0;right:0;height:var(--safeTop);background:#fff;box-shadow:0 1px 0 rgba(0,0,0,.06);z-index:1000;pointer-events:none}
  body.has-chip{padding-top:var(--safeTop)}
  .chip{position:fixed;top:10px;right:10px;background:#134c07;color:#fff;border-radius:999px;padding:6px 10px;font-size:12px;font-weight:600;box-shadow:0 2px 6px rgba(0,0,0,.12);z-index:1001;opacity:.9;transform:scale(.9)}
  .chip.show{opacity:1;transform:translateY(0)}
</style>

<!-- libs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.min.js"></script>
<!-- no inline workerSrc here; set safely in JS after load -->
<script src="https://unpkg.com/tesseract.js@4/dist/tesseract.min.js"></script>
</head>
<body>
  <div id="chipSafe" hidden></div>
  <div id="userChip" class="chip" hidden></div>

  <!-- Splash -->
  <section id="splash" class="vh fade">
    <div class="inner">
      <img class="logo" src="logo.png" alt="RateHound" />
    </div>
  </section>

  <!-- Signup -->
  <section id="signup" class="vh">
    <div class="inner">
      <h1>Get ready to save on your electric bill!</h1>
      <input class="field" id="name"  placeholder="Full name" autocomplete="name" inputmode="text" />
      <input class="field" id="phone" placeholder="Phone" autocomplete="tel" inputmode="tel" />
      <input class="field" id="email" placeholder="Email" type="email" autocomplete="email" />
      <button class="btn" id="signUpBtn" disabled>Sign up</button>
      <p class="hint">Demo only. No data is sent or stored.</p>
    </div>
  </section>

  <!-- Upload -->
  <section id="upload" class="vh">
    <div class="inner">
      <h1 id="uploadTitle">Provide a copy of your most recent electric bill.</h1>

      <button class="method" id="mBtnUpload">Upload / Take Photo</button>

      <div id="m-upload" class="panel" hidden>
        <input id="billFile" type="file" accept="image/*,application/pdf" aria-label="Upload or take a photo of your bill" hidden />
        <img id="preview" class="preview" alt="Bill preview" />
      </div>

      <button class="btn" id="continueUpload">Continue</button>
      <p class="hint">Demo only. No data is sent or stored.</p>
    </div>
  </section>

  <!-- Results -->
  <section id="results" class="vh" style="display:none">
    <div class="inner" id="resultsInner"></div>
  </section>

  <!-- Loader -->
  <section id="loader" class="vh">
    <div id="lottieContainer"></div>
  </section>

  <!-- Toasts -->
  <div id="toasts" aria-live="polite" aria-atomic="true"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  /* ---------- PDF.js guarded init ---------- */
  const PDFJS = window.pdfjsLib || window['pdfjs-dist/build/pdf'] || null;
  if (PDFJS && PDFJS.GlobalWorkerOptions) {
    PDFJS.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.2.67/pdf.worker.min.js";
  } else {
    console.warn('PDF.js not available; PDF uploads will be skipped.');
  }

  /* ---------- splash → signup ---------- */
  const splash = document.getElementById('splash');
  const signup = document.getElementById('signup');

  setTimeout(() => {
    splash.classList.add('out');
    setTimeout(() => { splash.style.display = 'none'; signup.classList.add('show'); }, 450);
  }, 1200);

  splash.addEventListener('click', () => {
    splash.classList.add('out');
    setTimeout(() => { splash.style.display = 'none'; signup.classList.add('show'); }, 250);
  });

  /* ---------- signup enable ---------- */
  const signUpBtn  = document.getElementById('signUpBtn');
  const nameInput  = document.getElementById('name');
  const phoneInput = document.getElementById('phone');
  const emailInput = document.getElementById('email');

  function checkSignupFields(){
    signUpBtn.disabled = !(nameInput.value.trim() && phoneInput.value.trim() && emailInput.value.trim());
  }
  [nameInput, phoneInput, emailInput].forEach(el => el.addEventListener('input', checkSignupFields));
  checkSignupFields();

  renderUserChip();
  function renderUserChip(){
    const chip = document.getElementById('userChip');
    try{
      const user = JSON.parse(sessionStorage.getItem('rh_user') || '{}');
      if (user && user.email) {
        chip.textContent = `Signed in as ${user.email}`;
        chip.hidden = false;
        document.body.classList.add('has-chip');
        document.getElementById('chipSafe').hidden = false;
        requestAnimationFrame(() => chip.classList.add('show'));
      }
    } catch(e){}
  }

  /* ---------- shadow account + toasts (demo) ---------- */
  const APP_LINK = '#';
  const GAS_URL = 'https://script.google.com/macros/s/AKfycbyl5HwDc0MzkKZZsz1guTyvX0rOvjzMpB83ufmLtBmBVhqL5Wh3VBSaq-LCIJ7_hxsv/exec';
  const RH_SHARED_SECRET = '9c7e51dff93b4c42ae4cdb1e8c4b9d21';

  function createShadowAccount(){
    const user = {
      id: 'demo_' + Date.now(),
      name:  document.getElementById('name')?.value.trim() || '',
      phone: document.getElementById('phone')?.value.trim() || '',
      email: document.getElementById('email')?.value.trim() || '',
      createdAt: new Date().toISOString()
    };
    try { sessionStorage.setItem('rh_user', JSON.stringify(user)); } catch(e){}
    renderUserChip();
    return user;
  }

  function showToast(html, ms=4000){
    const wrap = document.getElementById('toasts');
    if (!wrap) return;
    const t = document.createElement('div');
    t.className = 'toast';
    t.innerHTML = html;
    wrap.appendChild(t);
    requestAnimationFrame(() => t.classList.add('show'));
    setTimeout(() => { t.classList.remove('show'); setTimeout(() => t.remove(), 250); }, ms);
  }

  function sendDemoWelcome(user){
    console.log('[DEMO SMS] Welcome to RateHound,', user.name, 'Username:', user.email);
    console.log('[DEMO EMAIL] Welcome to RateHound →', user.email);
    showToast('Welcome to RateHound, ' + (user.name || 'there') + '!');
    showToast('Your username is <strong>' + user.email + '</strong>.', 4000);
    showToast('Grab the app: <a href="'+APP_LINK+'" target="_blank" rel="noopener">RateHound App</a>', 7000);
  }

  /* ---------- helpers (PDF/Images/OCR) ---------- */
  async function pdfFirstPageAsImage(file, scale = 1.4) {
    if (!PDFJS) throw new Error('PDF.js not loaded');
    const buf = await file.arrayBuffer();
    const pdf = await PDFJS.getDocument({ data: buf }).promise;
    const page = await pdf.getPage(1);
    const viewport = page.getViewport({ scale });
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    canvas.width = viewport.width; canvas.height = viewport.height;
    await page.render({ canvasContext: ctx, viewport }).promise;
    const blob = await new Promise(res => canvas.toBlob(res, 'image/jpeg', 0.9));
    const dataUrl = canvas.toDataURL('image/jpeg', 0.9);
    return { blob, dataUrl };
  }

  async function blobToDataUrl(blob){
    return new Promise((res, rej) => {
      const fr = new FileReader();
      fr.onload = () => res(fr.result);
      fr.onerror = rej;
      fr.readAsDataURL(blob);
    });
  }

  async function downscaleImageBlob(blob, maxDim=1600, mime='image/jpeg', quality=0.82){
    const img = document.createElement('img');
    const url = URL.createObjectURL(blob);
    await new Promise(r => { img.onload = r; img.src = url; });
    const w=img.naturalWidth, h=img.naturalHeight;
    let nw=w, nh=h;
    if (Math.max(w,h)>maxDim){ const k=maxDim/Math.max(w,h); nw=Math.round(w*k); nh=Math.round(h*k); }
    const c=document.createElement('canvas'); c.width=nw; c.height=nh;
    c.getContext('2d').drawImage(img,0,0,nw,nh);
    return new Promise(res => c.toBlob(b => { URL.revokeObjectURL(url); res(b||blob); }, mime, quality));
  }

  async function ocrImage(blob) {
    const { data } = await Tesseract.recognize(blob, 'eng');
    return (data && data.text) ? data.text : '';
  }

  async function sendToAppsScriptVision({ imageBlob, userEmail }) {
    const compact = imageBlob.size > 900000 ? await downscaleImageBlob(imageBlob) : imageBlob;
    const imageDataUrl = await blobToDataUrl(compact);

    const payload = { userEmail, imageDataUrl, token: RH_SHARED_SECRET };

    const resp = await fetch(GAS_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      body: JSON.stringify(payload)
    });

    const text = await resp.text();
    let json;
    try { json = JSON.parse(text); }
    catch {
      console.error('Apps Script returned non-JSON:', { status: resp.status, text });
      throw new Error(`Server returned non-JSON (${resp.status})`);
    }
    if (!json.ok) throw new Error(json.error || 'Server error');
    return json.fields;
  }

  function extract080x20(text) {
    const m = (text || '').match(/0\s*8\s*0(?:\s*\d){17}/i);
    if (!m) return '';
    const digits = m[0].replace(/\D/g, '');
    return /^080\d{17}$/.test(digits) ? digits : '';
  }

  /* ---------- intake flow ---------- */
  signUpBtn.addEventListener('click', () => {
    if (signUpBtn.disabled) return;
    const user = createShadowAccount();
    sendDemoWelcome(user);
    signup.classList.remove('show');
    document.getElementById('upload').classList.add('show');
    uploadQueue = ['electric'];
    setUploadTitleFor('electric');
    /* no auto-select on load */
    window.scrollTo(0,0);
  });

  const titleEl     = document.getElementById('uploadTitle');
  const mBtns       = { upload: document.getElementById('mBtnUpload') };
  const panels      = { upload: document.getElementById('m-upload') };
  const fileInput   = document.getElementById('billFile');
  const previewEl   = document.getElementById('preview');
  const continueBtn = document.getElementById('continueUpload');

  let uploadQueue = [];
  let uploadIndex = 0;
  let currentMethod = null;
  let lastThumbUrl = null;

  function setUploadTitleFor(kind){
    titleEl.textContent = (kind === 'electric')
      ? 'Provide your electric account information.'
      : 'Upload your bill';
  }
  function enableContinue(){ continueBtn.classList.add('enabled'); continueBtn.style.opacity='1'; continueBtn.style.pointerEvents='auto'; }
  function disableContinue(){ continueBtn.classList.remove('enabled'); continueBtn.style.opacity='.5'; continueBtn.style.pointerEvents='none'; }
  function resetPanels(){
    Object.values(panels).forEach(p => p.hidden = true);
    Object.values(mBtns).forEach(b => b.classList.remove('selected'));
    if (fileInput) fileInput.value = '';
    if (previewEl) previewEl.style.display = 'none';
    currentMethod = null;
    disableContinue();
  }
  function selectMethod(which){
    resetPanels();
    currentMethod = which;
    mBtns[which].classList.add('selected');
    panels[which].hidden = false;
    validateUpload();
  }

  // Only this click opens the file picker
  mBtns.upload.addEventListener('click', () => { selectMethod('upload'); fileInput.click(); });

  function validateUpload(){
    if (currentMethod === 'upload'){
      const ok = !!fileInput.files?.[0];
      return ok ? enableContinue() : disableContinue();
    }
    disableContinue();
  }

  fileInput?.addEventListener('change', async () => {
    const f = fileInput.files?.[0];
    if (lastThumbUrl) { URL.revokeObjectURL(lastThumbUrl); lastThumbUrl = null; }

    if (!f) {
      previewEl.style.display = 'none';
      document.getElementById('parsedOut')?.remove();
      disableContinue();
      return;
    }

    let ocrSource = f;
    if (f.type === 'application/pdf' && PDFJS) {
      try {
        const { blob, dataUrl } = await pdfFirstPageAsImage(f, 1.4);
        previewEl.src = dataUrl; previewEl.style.display = 'block';
        ocrSource = blob;
      } catch (e) {
        console.error('PDF render failed:', e);
        previewEl.style.display = 'none';
      }
    } else {
      lastThumbUrl = URL.createObjectURL(f);
      previewEl.src = lastThumbUrl; previewEl.style.display = 'block';
    }

    let out = document.getElementById('parsedOut');
    if (!out) {
      out = document.createElement('pre');
      out.id = 'parsedOut';
      out.className = 'hint';
      out.style.whiteSpace = 'pre-wrap';
      document.getElementById('m-upload').appendChild(out);
    }
    out.textContent = '⏳ Reading your bill...';

    const timeout = new Promise((_, rej) => setTimeout(() => rej(new Error('Vision timeout')), 30000));

    try {
      const user = JSON.parse(sessionStorage.getItem('rh_user') || '{}');
      const userEmail = user && user.email ? String(user.email) : '';

      const fields = await Promise.race([
        sendToAppsScriptVision({ imageBlob: ocrSource, userEmail }),
        timeout
      ]);

      if (!fields || (!fields.customerNumber && !fields.name)) {
        out.textContent = '❌ Could not read bill details. Please retake or upload a clearer photo.';
        disableContinue();
        return;
      }

      out.textContent = [
        `Customer number: ${fields.customerNumber || '(missing)'}`,
        `Name: ${fields.name || ''}`,
        `Address: ${fields.address || ''}`,
        `Zip: ${fields.zip || ''}`,
        `Bill period: ${fields.billPeriodEnd || ''}`
      ].join('\n');

      window.__rh_fields = fields;
      enableContinue();

    } catch (err) {
      console.warn('Vision parse failed, using on-device OCR:', err);
      out.textContent = '⚠️ Server failed; using on-device OCR...';
      try {
        const text = await ocrImage(ocrSource);
        const num = extract080x20(text);
        if (!num) {
          out.textContent += '\n❌ Could not find a valid 080xxxxxxxxxxxxxxxxx number.';
          disableContinue();
          return;
        }
        const local = { customerNumber: num, ...parseFields(text) };
        out.textContent = [
          `Customer number: ${local.customerNumber}`,
          `Name: ${local.name || ''}`,
          `Address: ${local.address || ''}`,
          `Zip: ${local.zip || ''}`,
          `Bill period: ${local.billPeriodEnd || ''}`
        ].join('\n');
        window.__rh_fields = local;
        enableContinue();
      } catch (e2) {
        out.textContent = '❌ Could not read the bill.';
        disableContinue();
      }
      return;
    }
  });

  /* ---------- continue → fake results ---------- */
  continueBtn.addEventListener('click', () => {
    if (!continueBtn.classList.contains('enabled')) return;
    document.getElementById('upload').classList.remove('show');
    document.getElementById('loader').classList.add('show');

    if (window.lottie && !window.__loaderAnim){
      window.__loaderAnim = lottie.loadAnimation({
        container: document.getElementById('lottieContainer'),
        renderer: 'svg', loop: true, autoplay: true,
        path: 'loader.json'
      });
    } else if (window.__loaderAnim){
      window.__loaderAnim.play();
      window.__loaderAnim.resize && window.__loaderAnim.resize();
    }

    window.scrollTo(0,0);
    setTimeout(() => showLoaderThen(uploadQueue[uploadIndex] || 'electric'), 1200);
  });

  function showLoaderThen(kind){
    const results = document.getElementById('results');
    const box     = document.getElementById('resultsInner');

    const planName='ClearGuarantee9Plus', ptc='9.39¢ / kWh', newRate='4.79¢ / kWh', term='9 Months', etf='$150', estSavings='45.1%';

    box.innerHTML = `
      <div class="card">
        <div class="yellowBox--sm">Price to Compare: ${ptc}</div>
        <hr>
        <div class="leadGreen" style="margin:8px 0 10px">Here's the lowest rate we found for you.</div>
        <div class="yellowBox--lg ratePill"><div class="big">${newRate}</div></div>
        <div style="margin:10px 0 6px">
          <div style="font-weight:800;color:#134c07">Plan:</div>
          <div style="font-size:18px">${planName}</div>
        </div>
        <div class="row2" style="margin-top:8px">
          <div class="blk"><div style="font-weight:800;color:#134c07">Contract Term</div>${term}</div>
          <div class="blk"><div style="font-weight:800;color:#134c07">Early Termination Fee</div>${etf}</div>
        </div>
        <div class="yellowBox--lg savingsPill">Estimated Savings: <span class="big">${estSavings}</span></div>
        <button id="ctaSwitch" class="btn-cta">Switch me to this plan!</button>
        <hr style="margin:18px 0 10px">
        <div class="supplier" style="margin-top:0;display:flex;align-items:center;gap:12px;padding-top:12px;border-top:1px solid #e6e8eb">
          <img src="clearwater logo.png" alt="clearwater logo" style="height:40px" />
          <span style="font-weight:800;color:#134c07">Clearview Energy</span>
        </div>
        <div class="links" style="margin-top:12px">
          <a href="#">Clearview Energy Terms &amp; Conditions</a><br />
          <a href="#">RateHound Terms of Service</a>
        </div>
        <div class="disclaimer" style="margin-top:12px">This rate will be effective following the first billing date after successful enrollment.</div>
      </div>`;
    document.getElementById('loader').classList.remove('show');
    results.style.display = 'flex';
    box.querySelector('#ctaSwitch')?.addEventListener('click', () =>
      showToast('Great — we’ll start the switch (demo).', 4200)
    );
  }

  /* ---- client-side parsing fallback ---- */
  function parseFields(text){
    const t = (text || "").replace(/\r/g, "");
    const customerNumber = extract080x20(t);

    const billBlockMatch = t.match(/Bill\s*for[:\s]*(.+?)(?:\n{2,}|Billing\s*Period|Bill\s*Date|Account\s*Number)/is);
    const billBlock = billBlockMatch ? billBlockMatch[1].trim() : "";
    const lines = billBlock.split(/\n/).map(s => s.trim()).filter(Boolean);

    const name   = lines[0] || "";
    const address = (lines.find(l => /^\d+[\sA-Za-z]/.test(l)) || lines[1] || "").replace(/\s{2,}/g," ").trim();

    const zipMatch =
      (lines.slice(-2).join(" ").match(/\b(\d{5})(?:-\d{4})?\b/)) ||
      (billBlock.match(/\b(\d{5})(?:-\d{4})?\b/));
    const zip = zipMatch ? zipMatch[1] : "";

    const bp = t.match(/Billing\s*Period[:\s]*([A-Za-z]{3,9}\s+\d{1,2})\s*(?:to|–|-|—)\s*([A-Za-z]{3,9}\s+\d{1,2})(?:,\s*(\d{4}))?/i);
    let billPeriodEnd = "";
    if (bp) {
      const right = bp[2];
      const year  = bp[3] || new Date().getFullYear();
      const endDate = new Date(`${right}, ${year}`);
      billPeriodEnd = endDate.toLocaleString('en-US', { month: 'short', day: 'numeric' });
    }

    return { customerNumber, name, address, zip, billPeriodEnd };
  }
});
</script>
</body>
</html>
